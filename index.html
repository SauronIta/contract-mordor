<!DOCTYPE html><html lang="it"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Le fucine di mordor: Contratti e dove trovarli</title>
<style>body{font-family:Arial,sans-serif;background:#0c0c19;color:#e0e0e0;margin:0}.header{padding:16px 20px;background:#141433;border-bottom:1px solid #3a3a6a;display:flex;justify-content:space-between;align-items:center}.header h1{margin:0;font-size:20px;color:#00d4ff}.container{display:flex;gap:18px;padding:18px}.panel{background:#16163a;border:1px solid #3a3a6a;border-radius:12px;padding:16px}.left{width:360px}.right{flex:1;min-width:0}label{display:block;margin:8px 0 4px;color:#9fb3ff}input{width:100%;padding:10px;border:1px solid #4b4b7a;border-radius:8px;background:#1e1e4a;color:#e0e0e0}button{padding:10px 12px;border:none;border-radius:8px;background:#0077ff;color:#fff;cursor:pointer}button.secondary{background:#444c7a}button.danger{background:#d9534f}.row{display:flex;gap:8px}.small{font-size:12px;color:#9aa7ff}table{width:100%;border-collapse:collapse;margin-top:10px}th,td{border-bottom:1px solid #2a2a55;padding:10px;text-align:left;font-size:14px}.badge{padding:2px 6px;border-radius:6px;font-size:12px}.badge.on{background:#1f7a4d}.badge.off{background:#7a1f1f}.actions{display:flex;gap:6px;flex-wrap:wrap}</style></head>
<body><div class="header"><h1>Le fucine di mordor: Contratti e dove trovarli</h1><div class="small">Render-ready â€¢ Poll 60s â€¢ Discord embed</div></div>
<div class="container"><div class="panel left"><h3>Aggiungi monitor</h3><label>Nome</label><input id="name" placeholder="Es. Infrastructure Contract"/><label>URL</label><input id="url" placeholder="https://atlas.eveeye.com/?market..."/><div class="row" style="margin-top:8px"><button id="add">âž• Aggiungi</button><button class="secondary" id="refresh">ðŸ”„ Aggiorna</button><button class="secondary" id="testDiscord">ðŸ§ª Test Discord</button></div></div>
<div class="panel right"><h3>Monitor attivi</h3><table id="table"><thead><tr><th>Nome</th><th>Status</th><th>Ultimo check</th><th>Alert</th><th>Azione</th></tr></thead><tbody id="tbody"><tr><td colspan="5" class="small">Nessun elemento ancora</td></tr></tbody></table></div></div>
<script>
async function listItems(){ const r=await fetch('/api/items'); const d=await r.json(); return d.items; }
async function addItem(it){ const r=await fetch('/api/items',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(it)}); return r.json(); }
async function patchItem(id, body){ const r=await fetch('/api/items/'+id,{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); return r.json(); }
async function delItem(id){ const r=await fetch('/api/items/'+id,{method:'DELETE'}); return r.json(); }
async function runItem(id){ const r=await fetch('/api/run/'+id',{method:'POST'}); return r.json(); }
function fmtTs(ts){ if(!ts) return '-'; try{return new Date(ts).toLocaleTimeString('it-IT')}catch{return ts} }
async function render(){ const items=await listItems(); const tbody=document.getElementById('tbody'); tbody.innerHTML=''; if(!items.length){ const tr=document.createElement('tr'); tr.innerHTML='<td colspan="5" class="small">Nessun elemento</td>'; tbody.appendChild(tr); return; } for(const it of items){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${it.name}</td><td><span class="badge ${it.enabled?'on':'off'}">${it.enabled?'ATTIVO':'FERMO'}</span></td><td>${fmtTs(it.lastCheck)}</td><td>${it.alerts||0}</td><td class="actions"><button onclick="toggle('${it.id}', ${!it.enabled})">${it.enabled?'Stop':'Start'}</button><button class="secondary" onclick="run('${it.id}')">Check ora</button><button class="danger" onclick="removeIt('${it.id}')">Rimuovi</button></td>`; tbody.appendChild(tr);} }
async function toggle(id, enabled){ await patchItem(id,{enabled}); render(); }
async function run(id){ const r=await runItem(id); alert(r.ok?'Check eseguito':'Errore'); render(); }
async function removeIt(id){ if(confirm('Rimuovere?')){ await delItem(id); render(); } }
document.getElementById('add').onclick=async()=>{ const name=document.getElementById('name').value.trim(); const url=document.getElementById('url').value.trim(); if(!name||!url){alert('Nome e URL obbligatori');return;} await addItem({name,url,enabled:true}); document.getElementById('name').value=''; document.getElementById('url').value=''; render(); };
document.getElementById('refresh').onclick=render;
document.getElementById('testDiscord').onclick=async()=>{ const r=await fetch('/api/test-discord',{method:'POST'}); alert(r.ok?'Messaggio di test inviato':'Errore invio test'); };
render(); setInterval(render, 10000);
</script></body></html>
